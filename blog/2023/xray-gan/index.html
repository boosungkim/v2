<!DOCTYPE html>
<html lang="en">

  <!-- Head -->
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">    <!-- Metadata, OpenGraph and Schema.org -->
    

    <!-- Standard metadata -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>How GANs can be used to synthesize X-Rays | Boosung  Kim</title>
    <meta name="author" content="Boosung  Kim">
    <meta name="description" content="How Generative Adversarial Networks are used to synthesize X-Rays">
    <meta name="keywords" content="portfolio-website">


    <!-- Bootstrap & MDB -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous">

    <!-- Bootstrap Table -->
    <link defer rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.21.4/dist/bootstrap-table.min.css">

    <!-- Fonts & Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons">

    <!-- Code Syntax Highlighting -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="" id="highlight_theme_light">

    
    <!-- Sidebar Table of Contents -->
    <link href="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.css" rel="stylesheet">
    

    <!-- Styles -->
    
    <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%F0%9F%94%A5&lt;/text&gt;&lt;/svg&gt;">
    
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="canonical" href="https://boosungkim.com/blog/2023/xray-gan/">

    <!-- Dark Mode -->
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/native.css" media="none" id="highlight_theme_dark">

    <script src="/assets/js/theme.js"></script>
    <script src="/assets/js/dark_mode.js"></script>
    

  </head>

  <!-- Body -->
  <body class="fixed-top-nav sticky-bottom-footer">

    <!-- Header -->
    <header>

      <!-- Nav Bar -->
      <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top">
        <div class="container">
          <a class="navbar-brand title font-weight-lighter" href="/"><span class="font-weight-bold">Boosung </span>Kim</a>

            <!-- Boo's edit: custom addition to add social icons to navbar -->
            <div class="navbar-brand social"> 
              <a href="mailto:%62%6F%6F%73%75%6E%67@%62%6F%6F%73%75%6E%67%6B%69%6D.%63%6F%6D" title="email"><i class="fas fa-envelope"></i></a>
            <a href="https://github.com/boosungkim" title="GitHub" rel="external nofollow noopener" target="_blank"><i class="fab fa-github"></i></a>
            <a href="https://www.linkedin.com/in/boosungk" title="LinkedIn" rel="external nofollow noopener" target="_blank"><i class="fab fa-linkedin"></i></a>
            <a href="https://twitter.com/bytesofboosung" title="Twitter" rel="external nofollow noopener" target="_blank"><i class="fab fa-twitter"></i></a>
            <a href="https://www.kaggle.com/boosungkim" title="Kaggle" rel="external nofollow noopener" target="_blank"><i class="fab fa-kaggle"></i></a>
            <a href="https://youtube.com/@converge2diverge" title="YouTube" rel="external nofollow noopener" target="_blank"><i class="fab fa-youtube"></i></a>
            <a href="/feed.xml" title="RSS Feed"><i class="fas fa-rss-square"></i></a>
            

            </div>

          <!-- Navbar Toggle -->
          <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar top-bar"></span>
            <span class="icon-bar middle-bar"></span>
            <span class="icon-bar bottom-bar"></span>
          </button>

          <div class="collapse navbar-collapse text-right" id="navbarNav">
            <ul class="navbar-nav ml-auto flex-nowrap">

              <!-- About -->
              <li class="nav-item ">
                <a class="nav-link" href="/">about</a>
              </li>
              
              <!-- Blog -->
              <li class="nav-item active">
                <a class="nav-link" href="/blog/">blog<span class="sr-only">(current)</span></a>
              </li>

              <!-- Other pages -->
              <li class="nav-item ">
                <a class="nav-link" href="/projects/">projects</a>
              </li>
              <li class="nav-item ">
                <a class="nav-link" href="/cv/">cv</a>
              </li>

              <!-- Toogle theme mode -->
              <li class="toggle-container">
                <button id="light-toggle" title="Change theme">
                  <i class="fas fa-moon"></i>
                  <i class="fas fa-sun"></i>
                </button>
              </li>
            </ul>
          </div>
        </div>
      </nav>

      <!-- Scrolling Progress Bar -->
      <progress id="progress" value="0">
        <div class="progress-container">
          <span class="progress-bar"></span>
        </div>
      </progress>
    </header>


    <!-- Content -->
    <div class="container mt-5">
      
        
        <div class="row">
          <!-- main content area -->
          <div class="col-sm-9">
            <!-- _layouts/post.html -->

<div class="post">

  <header class="post-header">
    <h1 class="post-title">How GANs can be used to synthesize X-Rays</h1>
    <p class="post-meta">June 18, 2023</p>
    <p class="post-tags">
      <a href="/blog/2023"> <i class="fas fa-calendar fa-sm"></i> 2023 </a>
        ·  
        <a href="/blog/category/computer-vision">
          <i class="fas fa-tag fa-sm"></i> computer-vision</a>  
          <a href="/blog/category/paper-review">
          <i class="fas fa-tag fa-sm"></i> paper-review</a>  
          

    </p>
  </header>

  <article class="post-content">
    
    <div id="markdown-content">
      <p><a href="https://www.researchgate.net/publication/328945795_Synthesizing_Chest_X-Ray_Pathology_for_Training_Deep_Convolutional_Neural_Networks" rel="external nofollow noopener" target="_blank">Synthesizing Chest X-Ray Pathology for Training
Deep Convolutional Neural Networks</a></p>

<p>My friend Daesung Kim, who studies the use of Computer Vision in medical research, recently approached me with an interesting paper to get my opinion. The paper was “Synthesizing Chest X-Ray Pathology for Training
Deep Convolutional Neural Networks,” and it provided an insight on how GANs can be effectively be used in the medical world.</p>

<p>The authors of the paper suggest using Deep Convolutional Generative Adversarial Networks (DCGAN) to create synthesized chest X-rays through a custom model. The results show that the addition of these synthesized data leads to improved performance of pathology classification.</p>

<h2 id="what-are-gans">What are GANs?</h2>
<p><img src="/assets/img/blogs/2023/2023-06-18-xray-gan/gan-example.png" width="500"></p>

<p><em>Figure 1: GAN generated art by u/TheAngryGoat</em></p>

<p>GAN, or Generative Adversarial Network, is an area of Computer Vision that focuses on generating new images. The “Adversarial” part comes from the use of a generator and a discriminator components in the model. GANs are primarily responsible for the AI artworks you probably have seen floating around on the internet.</p>

<p>However, in many cases, GANs can be used to generate synthetic data samples, especially for when the training dataset is lacking.</p>

<p><img src="/assets/img/blogs/2023/2023-06-18-xray-gan/gan-architecture.png" width="600"></p>

<p><em>Figure 2: GAN architectures</em></p>

<p>The generator component is responsible for creating synthetic data samples. It takes random noise or input data as an initial input and generates new samples based on the patterns it has learned during training.</p>

<p>The discriminator component, on the other hand, acts as a classifier for the images. It aims to learn to distinguish between real data samples and synthetic samples created by the generator. The discriminator’s objective is to correctly classify real and synthetic data samples.</p>

<p>During training, the generator and discriminator are pitted against each other in a game-like setting. The generator tries to generate synthetic samples that fool the discriminator into thinking they are real, while the discriminator tries to accurately classify the real and synthetic samples. This competition between the generator and discriminator helps both components improve over time.</p>

<p>As the training progresses, the generator becomes more adept at generating realistic samples that resemble the training data, while the discriminator becomes more accurate in distinguishing between real and synthetic samples. The ultimate goal is to train a generator that can produce synthetic data samples that are indistinguishable from real data, as judged by the discriminator.</p>

<h2 id="synthesizing-chest-x-rays">Synthesizing Chest X-Rays</h2>
<p><img src="/assets/img/blogs/2023/2023-06-18-xray-gan/synthesizing-xray-architecture.png" width="600"></p>

<p><em>Figure 3: Custom GAN architecture for synthesizing X-rays</em></p>

<p>Daesung is tackling an imbalance issue in his X-ray training dataset at work, and he has turned to GANs to generate synthetic data samples.</p>

<p>In the paper, the authors present their custom DCGAN model, which utilizes fractionally-strided convolutions. They demonstrate that with each iteration, the model improves significantly, transforming distinguishable chest structures into detailed representations of ribs and vessels in just 18 epochs.</p>

<p><img src="/assets/img/blogs/2023/2023-06-18-xray-gan/chest-gan-epochs.png" width="600"></p>

<p><em>Figure 4: Visualization of random samples for different epochs</em></p>

<h2 id="latent-feature-spaces">Latent feature spaces</h2>
<p>To efficiently measure the quality of the synthesized images, the authors utilize the concept of the Latent Feature Space.</p>

<p>Instead of measuing quality by pixel by pixel, the authors use a custom convolutional autoencoder (Figure 5), consisting of non-linear encoder function (\(g_e(x)\)), a non-linear decoder function (\(g_d(\psi)\)), 8 feature maps, to reduce the images of 256x256 to 16x16. The purpose of this autoencoder is to learn</p>

\[g_d(g_e(X)) \approx X.\]

<p><img src="/assets/img/blogs/2023/2023-06-18-xray-gan/autoencoder.png" alt="image"></p>

<p><em>Figure 5: Convolutional autoencoder</em></p>

<p>To clarify, the latent space refers to the lower-dimensional representation of the synthesized image obtained through the autoencoder.</p>

<p>Using the autoencoder, the authors calculate a feature map in the latent space as a vector:</p>

\[\psi_{c,v}^K = [\psi_{K,1}, \psi_{K,2}, \dots, \psi_{K,256}],\]

<p>where \(c\) represents the class of the image, \(v\) represents the number of randomly selected X-ray images per class, \(K\) indicates the categories of real and synthesized images.</p>

<p>The authors further compute the centroid of the latent space:</p>

\[\hat{\gamma}_c^K = \frac{1}{N}\sum^N_{v=1}\hat{\psi}_{c,v}^K.\]

<p>By comparing the centroids of the real and synthesized features, the authors demonstrate the similarity between the two.</p>

<h2 id="why-box-plots">Why box plots?</h2>
<p><img src="/assets/img/blogs/2023/2023-06-18-xray-gan/box-plots.png" alt="image"></p>

<p>This is the part where we are a little stuck. These are box-plots of euclidean distances between centroid of each synthesized chest X-rays with the centroid of other real X-rays. Hence, it makes that only each class is the closest to real images (Synthesized closest box-plot lowest in (a), Synthesized Cardiomegaly lowest in (b), and so on).</p>

<p>The question is, should there not be just one centroid per class? Why is there a box plot for each class? The result from the earlier equation should return us a vector of a single centroid for the input feature vector. Then why are multiple centroids per class as shown in this box plot?</p>

<p>Our theory is that there are multiple centroids per class per real synthesized due to mini-batches (remember we took N random samples to get the feature vector earlier). We are still looking into this and will update the blog once we get a definitive answer. If you feel like you understand, please go ahead and let us know.</p>

<h2 id="performance-and-future-directions">Performance and Future directions</h2>
<p>Finally, the model performance.</p>

<p><img src="/assets/img/blogs/2023/2023-06-18-xray-gan/performance.png" width="600"></p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Dataset Name</th>
      <th style="text-align: center">Abbreviation</th>
      <th style="text-align: left">Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">Balanced Real Dataset</td>
      <td style="text-align: center">BR</td>
      <td style="text-align: left">Balanced version of original dataset</td>
    </tr>
    <tr>
      <td style="text-align: left">Balanced real dataset augmented with synthesized X-rays</td>
      <td style="text-align: center">BG</td>
      <td style="text-align: left">Balanced version of original dataset with synthesized data</td>
    </tr>
    <tr>
      <td style="text-align: left">Imbalanced real dataset</td>
      <td style="text-align: center">IR</td>
      <td style="text-align: left">All available original data</td>
    </tr>
    <tr>
      <td style="text-align: left">Imbalanced real dataset augmented with rotation and scaling</td>
      <td style="text-align: center">RS</td>
      <td style="text-align: left">All available original data with scaled and rotated variants</td>
    </tr>
    <tr>
      <td style="text-align: left">Imbalanced real dataset augmented with synthesized X-rays</td>
      <td style="text-align: center">GS</td>
      <td style="text-align: left">All original data with synthesized date (double the original amount)</td>
    </tr>
  </tbody>
</table>

<p>The results show that doubling the amount of data with DCGAN synthesized images (GS) improve the performance over the original (IR) for all models, and even improve ResNet50 by nearly 20%.</p>

<p>The results clearly indicate the success of synthesizing chest X-ray images with DCGANs.</p>

<h2 id="references">References</h2>
<ol>
  <li><a href="https://www.researchgate.net/publication/328945795_Synthesizing_Chest_X-Ray_Pathology_for_Training_Deep_Convolutional_Neural_Networks" rel="external nofollow noopener" target="_blank">Synthesizing Chest X-Ray Pathology for Training
Deep Convolutional Neural Networks</a></li>
  <li><a href="https://www.reddit.com/r/StableDiffusion/comments/11bvx8d/using_controlnet_to_demonstrate_how_ai_generated/" rel="external nofollow noopener" target="_blank">(Figure 1) GAN art by u/theAngryGoat</a></li>
</ol>

    </div>
  </article>


  
    
    <br>
    <hr>
    <br>
    <ul class="list-disc pl-8"></ul>

    <!-- Adds related posts to the end of an article -->
    <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2>
    <p class="mb-2">Here are some more articles you might like to read next:</p>
  

  <li class="my-2">
    <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2023/meeting-professor-andrew-ng/">I got to meet Professor Andrew Ng! (SNU Data Science Day Recap)</a>
  </li>

  

  <li class="my-2">
    <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2023/deeplearnlab/">Introducing DeepLearnLab</a>
  </li>

  

  <li class="my-2">
    <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2023/chess-engine-comeback/">The time I coded Chess with pen and paper in the Korean Army</a>
  </li>

  

  <li class="my-2">
    <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2023/the-imagenet-5/">I implemented 5 CNN papers. Here's what I learned.</a>
  </li>

  

  <li class="my-2">
    <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2023/efficientnet-implementation/">EfficientNet Implementation</a>
  </li>

</div>

          </div>
          <!-- sidebar, which will move to the top on a small screen -->
          <div class="col-sm-3">
            <nav id="toc-sidebar" class="sticky-top"></nav>
          </div>
        </div>
        
      
    </div>

    <!-- Footer -->    <footer class="sticky-bottom mt-5">
      <div class="container">
        © Copyright 2023 Boosung  Kim. 
      </div>
    </footer>

    <!-- JavaScripts -->
    <!-- jQuery -->
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>

    <!-- Bootsrap & MDB scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script>

    <!-- Masonry & imagesLoaded -->
  <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script>
  <script defer src="/assets/js/masonry.js" type="text/javascript"></script>
    
  <!-- Medium Zoom JS -->
  <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script>
  <script defer src="/assets/js/zoom.js"></script>
  <!-- Sidebar Table of Contents -->
  <script defer src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script>


  <!-- Bootstrap Table -->
  <script defer src="https://unpkg.com/bootstrap-table@1.21.4/dist/bootstrap-table.min.js"></script>

  <!-- Load Common JS -->
  <script src="/assets/js/no_defer.js"></script>
  <script defer src="/assets/js/common.js"></script>
  <script defer src="/assets/js/copy_code.js" type="text/javascript"></script>

    
  <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script>
  <script async src="https://badge.dimensions.ai/badge.js"></script>

    <!-- MathJax -->
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        tags: 'ams'
      }
    };
  </script>
  <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script>
  <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>

    
    

<!-- Scrolling Progress Bar -->
<script type="text/javascript">
  /*
   * This JavaScript code has been adapted from the article 
   * https://css-tricks.com/reading-position-indicator/ authored by Pankaj Parashar, 
   * published on the website https://css-tricks.com on the 7th of May, 2014.
   * Couple of changes were made to the original code to make it compatible 
   * with the `al-foio` theme.
   */
  const progressBar = $("#progress");
  /*
   * We set up the bar after all elements are done loading.
   * In some cases, if the images in the page are larger than the intended
   * size they'll have on the page, they'll be resized via CSS to accomodate
   * the desired size. This mistake, however, breaks the computations as the
   * scroll size is computed as soon as the elements finish loading.
   * To account for this, a minimal delay was introduced before computing the
   * values.
   */
  window.onload = function () {
    setTimeout(progressBarSetup, 50);
  };
  /*
   * We set up the bar according to the browser.
   * If the browser supports the progress element we use that.
   * Otherwise, we resize the bar thru CSS styling
   */
  function progressBarSetup() {
    if ("max" in document.createElement("progress")) {
      initializeProgressElement();
      $(document).on("scroll", function() {
        progressBar.attr({ value: getCurrentScrollPosition() });
      });
      $(window).on("resize", initializeProgressElement);
    } else {
      resizeProgressBar();
      $(document).on("scroll", resizeProgressBar);
      $(window).on("resize", resizeProgressBar);
    }
  }
  /*
   * The vertical scroll position is the same as the number of pixels that
   * are hidden from view above the scrollable area. Thus, a value > 0 is
   * how much the user has scrolled from the top
   */
  function getCurrentScrollPosition() {
    return $(window).scrollTop();
  }

  function initializeProgressElement() {
    let navbarHeight = $("#navbar").outerHeight(true);
    $("body").css({ "padding-top": navbarHeight });
    $("progress-container").css({ "padding-top": navbarHeight });
    progressBar.css({ top: navbarHeight });
    progressBar.attr({
      max: getDistanceToScroll(),
      value: getCurrentScrollPosition(),
    });
  }
  /*
   * The offset between the html document height and the browser viewport
   * height will be greater than zero if vertical scroll is possible.
   * This is the distance the user can scroll
   */
  function getDistanceToScroll() {
    return $(document).height() - $(window).height();
  }

  function resizeProgressBar() {
    progressBar.css({ width: getWidthPercentage() + "%" });
  }
  // The scroll ratio equals the percentage to resize the bar
  function getWidthPercentage() {
    return (getCurrentScrollPosition() / getDistanceToScroll()) * 100;
  }
</script>

  </body>
</html>
